[
  {
    "conditions": {
      "time_of_day": { "or": [ { "is": "morning" }, { "is": "afternoon" } ] },
      "target.mappable.terrain": { "or": [ { "is": "grassland" }, { "is": "dirt" } ] },
      "not": { "other": { "habitable": "exists" } },
      "season": { "not": { "is": "winter" } },
      "distance": { "is": 0 }
    },
    "event": {
      "key": "plough_field",
      "turns": 2,
      "rules": {
        "target": [
          { "event": { "mappable": { "set": { "terrain": "ploughed" } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "not": { "other": { "habitable": "exists" } },
      "target.mappable.terrain": { "is": "grassland" },
      "time_of_day": { "not": { "is": "night" } },
      "season": {
        "or": [ { "is": "summer" } , { "is": "autumn" } ]
      },
      "distance": { "is": 0 }
    },
    "event": {
      "key": "gather_grain",
      "turns": 1,
      "rules": {
        "controller": [
          { "event": { "supplies": { "gain": { "grain": 1 } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "target.mappable.terrain": { "is": "harvestable" },
      "time_of_day": { "or": [ { "is": "morning" }, { "is": "afternoon" } ] },
      "distance": { "is": 0 }
    },
    "event": {
      "key": "harvest_field",
      "turns": 2,
      "rules": {
        "controller": [
          { "event": { "supplies": { "gain": { "grain": 5 } } } }
        ],
        "target": [
          { "event": { "mappable": { "set": { "terrain": "dirt" } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "time_of_day": { "or": [ { "is": "morning" }, { "is": "afternoon" } ] },
      "target.mappable.terrain": { "is": "ploughed" },
      "controller.supplies.grain": { "greater": 0 },
      "season": { "not": { "is": "winter" } },
      "distance": { "lessEq": 2 }
    },
    "event": {
      "key": "sow_field",
      "turns": 2,
      "rules": {
        "controller": [
          { "event": { "supplies": { "lose": { "grain": 1 } } } }
        ],
        "target": [
          { "event": { "mappable": { "set": { "terrain": "sown" } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "time_of_day": { "or": [ { "is": "morning" }, { "is": "afternoon" } ] },
      "target.mappable.terrain": { "is": "forest" },
      "distance": { "is": 0 }
    },
    "event": {
      "key": "chop_trees",
      "turns": 2,
      "rules": {
        "controller": [
          { "event": { "supplies": { "gain": { "wood": 1 } } } }
        ],
        "target": [
          {
            "conditions": {
              "traits.values": {
                "not": {
                  "or": [
                    { "has": "thinned" },
                    { "has": "deforested" },
                    { "has":  "decimated" }
                  ]
                }
              }
            },
            "event": { "traits.values": { "add": { "thinned" : 16 } } }
          },
          {
            "conditions": {
              "traits.values": {
                "has": "thinned"
              }
            },
            "event": { "traits.values": { "remove": "thinned", "add": { "deforested": 32 } } }
          },
          {
            "conditions": {
              "traits.values": {
                "has": "deforested"
              }
            },
            "event": { "traits.values": { "remove": "deforested", "add": { "decimated": 64 } } }
          },
          {
            "conditions": {
              "traits.values": {
                "has": "decimated"
              }
            },
            "event": { "traits.values": { "remove": "decimated" } }
          },
          {
            "conditions": {
              "traits.values": {
                "has": "decimated"
              }
            },
            "event": { "mappable": { "set": { "terrain": "dirt" } } }
          }
        ]
      }
    }
  },
  {
    "conditions": {
      "time_of_day": { "or": [ { "is": "morning" }, { "is": "afternoon" } ] },
      "target.mappable.terrain": { "is": "forest" },
      "distance": { "is": 0 },
      "not": { "target.traits.values": { "has": "planted" } }
    },
    "event": {
      "key": "plant_trees",
      "turns": 2,
      "rules": {
        "target": [
          { "event": { "traits.values": { "add": { "planted": true } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "target.mappable.terrain": { "is": "shallow water" },
      "distance": { "lessEq": 2 },
      "me.traits.values": { "has": "boat" }
    },
    "event": {
      "key": "fish",
      "rules": {
        "target": [
          { "event": { "traits.values": { "add": { "fished": 4 } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "target.personable": "exists",
      "target.personable.controller": {
        "not": { "is": "$controller.id" },
        "is": "$target.id"
      },
      "distance": { "is": 0 },
      "time_of_day": { "or": [ { "is": "morning" }, { "is": "afternoon" } ] }
    },
    "event": {
      "key": "recruit",
      "turns": 3,
      "rules": {
        "target": [
          { "event": { "personable": { "recruited": "controller" } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "target.habitable": "exists",
      "target.habitable.owners": { "includes": "$me.id" },
      "distance": { "is": 0 },
      "time_of_day": { "is": "night" }
    },
    "event": {
      "key": "sleep",
      "turns": 1,
      "rules": {}
    }
  },
  {
    "hidden": true,
    "conditions": {
      "target.mappable": "exists",
      "target.mappable.terrain": {
        "not": {
          "or": [
            { "is": "mountain" },
            { "is": "deep water" },
            { "is": "forest" },
            { "is": "shallow water" }
          ]
        }
      },
      "distance": { "is": 1 },
      "me.attributes.moves": { "greaterEq": 1 }
    },
    "event": {
      "key": "move",
      "turns": 0,
      "rules": {
        "me": [
          { "event": { "spatial": { "move": "target" } } },
          { "event": { "personable": { "explore": { "radius": 1 } } } },
          { "event": { "attributes": { "lose": {"moves": 1 } } } }
        ]
      }
    }
  },
  {
    "hidden": true,
    "conditions": {
      "target.mappable": "exists",
      "target.mappable.terrain": { "is": "forest" },
      "distance": { "is": 1 },
      "me.attributes.moves": { "greaterEq": 2 }
    },
    "event": {
      "key": "move",
      "turns": 0,
      "rules": {
        "me": [
          { "event": { "spatial": { "move": "target" } } },
          { "event": { "personable": { "explore": { "radius": 1 } } } },
          { "event": { "attributes": { "lose": {"moves": 2 } } } }
        ]
      }
    }
  }
]
