[
  {
    "conditions": {
      "time_of_day": { "not": { "is": "night" } },
      "target.mappable.terrain": { "or": [ { "is": "grassland" }, { "is": "dirt" } ] },
      "not": { "other": { "habitable": "exists" } }
    },
    "event": {
      "key": "plough_field",
      "rules": {
        "target": [
          { "event": { "mappable": { "set": { "terrain": "ploughed" } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "not": { "other": { "habitable": "exists" } },
      "target.mappable.terrain": { "is": "grassland" },
      "time_of_day": { "not": { "is": "night" } },
      "season": {
        "or": [ { "is": "summer" } , { "is": "autumn" } ]
      }
    },
    "event": {
      "key": "gather_grain",
      "rules": {
        "me": [
          { "event": { "supplies": { "gain": { "grain": 1 } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "target.mappable.terrain": { "is": "harvestable" },
      "time_of_day": { "not": { "is": "night" } }
    },
    "event": {
      "key": "harvest_field",
      "rules": {
        "me": [
          { "event": { "supplies": { "gain": { "grain": 5 } } } }
        ],
        "target": [
          { "event": { "mappable": { "set": { "terrain": "dirt" } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "time_of_day": { "not": { "is": "night" } },
      "target.mappable.terrain": { "is": "ploughed" },
      "me.supplies.grain": { "greater": 0 },
      "season": {
        "or": [ { "is": "spring" } , { "is": "summer" } ]
      }
    },
    "event": {
      "key": "sow_field",
      "rules": {
        "me": [
          { "event": { "supplies": { "lose": { "grain": 1 } } } }
        ],
        "target": [
          { "event": { "mappable": { "set": { "terrain": "sown" } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "target.habitable": "exists",
      "target.habitable.owners": { "includes": "$me.id" },
      "me.supplies.grain": { "greater": 0 }
    },
    "event": {
      "key": "prepare_gruel",
      "rules": {
        "me": [
          { "event": { "traits.values": { "add": { "eaten": 4 } } } },
          { "event": { "supplies": { "lose": { "grain": 1 } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "time_of_day": { "not": { "is": "night" } },
      "target.mappable.terrain": { "is": "forest" }
    },
    "event": {
      "key": "chop_trees",
      "rules": {
        "me": [
          { "event": { "supplies": { "gain": { "wood": 1 } } } }
        ],
        "target": [
          {
            "conditions": {
              "traits.values": {
                "not": {
                  "or": [
                    { "has": "thinned" },
                    { "has": "deforested" },
                    { "has":  "decimated" }
                  ]
                }
              }
            },
            "event": { "traits.values": { "add": { "thinned" : 16 } } }
          },
          {
            "conditions": {
              "traits.values": {
                "has": "thinned"
              }
            },
            "event": { "traits.values": { "remove": "thinned", "add": { "deforested": 32 } } }
          },
          {
            "conditions": {
              "traits.values": {
                "has": "deforested"
              }
            },
            "event": { "traits.values": { "remove": "deforested", "add": { "decimated": 64 } } }
          },
          {
            "conditions": {
              "traits.values": {
                "has": "decimated"
              }
            },
            "event": { "traits.values": { "remove": "decimated" } }
          },
          {
            "conditions": {
              "traits.values": {
                "has": "decimated"
              }
            },
            "event": { "mappable": { "set": { "terrain": "dirt" } } }
          }
        ]
      }
    }
  },
  {
    "conditions": {
      "time_of_day": { "not": { "is": "night" } },
      "target.mappable.terrain": { "is": "forest" },
      "not": { "target.traits.values": { "has": "planted" } }
    },
    "event": {
      "key": "plant_trees",
      "rules": {
        "target": [
          { "event": { "traits.values": { "add": { "planted": true } } } }
        ]
      }
    }
  },
  {
    "conditions": {
      "target.mappable.terrain": { "is": "shallow water" },
      "me.traits.values": { "has": "boat" }
    },
    "event": {
      "key": "fish",
      "rules": {
        "target": [
          { "event": { "traits.values": { "add": { "fished": 4 } } } }
        ]
      }
    }
  }
]
